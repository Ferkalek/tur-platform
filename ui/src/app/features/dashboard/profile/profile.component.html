

<div class="flex justify-content-between align-items-center mb-5">
	<h2 class="mb-0">Profile</h2>

	<button
		pButton
		type="button"
		class="p-button-outlined p-button-sm"
		icon="pi pi-pencil"
		label="Edit Profile"
		(click)="isEditFormOpened = true"
	></button>
</div>

<p-drawer
	[(visible)]="isEditFormOpened"
	position="right"
	styleClass="w-6 min-w-min"
>
	<ng-template #header>
		<h3>Edit Profile</h3>
	</ng-template>

	<app-profile-form [profile]="profile" (savingProfile)="saveProfile($event)" />
</p-drawer>

@if (loading) {
	<app-loader />
} @else {
	<div class="card animation-fade-in">
		<div class="flex align-items-center pb-5 mb-5 b-bottom">
			<div class="flex flex-column align-items-center gap-3">
				@if (profile.avatar) {
					<div class="avatar-preview">
						<img
							[src]="profile.avatar | staticUrl" 
							[alt]="profile.firstName + ' ' + profile.lastName"
							class="avatar-image"
						>
					</div>
					<div class="flex gap-1">
						<p-fileUpload
							#fileUpload
							mode="basic"
							name="avatar"
							accept="image/*"
							[maxFileSize]="5000000"
							[auto]="true"
							chooseStyleClass="p-button-sm border-0 p-button-icon-only p-button-outlined p-button-rounded"
							chooseLabel=""
							[chooseIcon]="'pi pi-pencil'"
							[disabled]="uploadingAvatar"
							(onSelect)="onAvatarSelect($event)"
							(onError)="onUploadError()"
							[customUpload]="true"
							(uploadHandler)="onAvatarUpload($event)"
						/>
						<button
							pButton
							icon="pi pi-trash"
							class="border-0 p-button-sm"
							[rounded]="true"
							[outlined]="true"
							(click)="deleteAvatar()"
						></button>
					</div>
				} @else {
					<p-avatar 
						[label]="getInitials()" 
						size="xlarge"
						class="custom-avatar"
					/>
					<p-fileUpload
						#fileUpload
						mode="basic"
						name="avatar"
						accept="image/*"
						[maxFileSize]="5000000"
						[auto]="true"
						chooseStyleClass="p-button-sm p-button-outlined"
						chooseLabel="Add photo"
						[chooseIcon]="uploadingAvatar ? 'pi pi-spin pi-spinner' : 'pi pi-upload'"
						[disabled]="uploadingAvatar"
						(onSelect)="onAvatarSelect($event)"
						(onError)="onUploadError()"
						[customUpload]="true"
						(uploadHandler)="onAvatarUpload($event)"
					/>
				}
			</div>
			
			<div class="pl-4">
				<h3>{{ profile.firstName }} {{ profile.lastName }}</h3>
				<p class="text-gray">{{ profile.email }}</p>
			</div>
		</div>

		<h4>Phone Number:</h4>
		<p class="mb-4">{{ profile.phone || '--' }}</p>

		<h4>About Me:</h4>
		<p class="mb-4">{{ profile.bio || '--' }}</p>

		<h4>Social Link:</h4>
		<p>{{ profile.socialLink || '--' }}</p>
	</div>
}

<p-toast position="bottom-left" />